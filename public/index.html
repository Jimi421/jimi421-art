<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jimi421 Art Gallery</title>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#f7f7f7; color:#222; }
    h1 { text-align:center; padding:1rem 0; font-size:2rem; color:#444; }
    #gallery { display:grid; grid-template-columns:1fr; gap:1rem; padding:1rem; }
    @media(min-width:600px) { #gallery { grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); } }
    .card { background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1); cursor:default; position:relative; }
    .media { width:100%; height:200px; object-fit:cover; }
    /* Floating Upload Button */
    #openUpload { position:fixed; bottom:20px; right:20px; background:#3498db; color:#fff; border:none; border-radius:50%; width:60px; height:60px; font-size:2rem; line-height:0; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
    /* Upload Modal */
    #uploadModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:2000; justify-content:center; align-items:center; }
    #uploadModal.active { display:flex; }
    .modal-content { background:#fff; border-radius:8px; padding:1.5rem; width:90%; max-width:400px; box-shadow:0 2px 12px rgba(0,0,0,0.2); }
    .modal-content h2 { margin-top:0; }
    .dropzone { border:2px dashed #bbb; border-radius:8px; padding:2rem; text-align:center; color:#888; margin-bottom:1rem; }
    .dropzone.hover { border-color:#3498db; color:#3498db; }
    #fileInput { display:none; }
    .btn { display:block; width:100%; padding:0.6rem; font-size:1rem; border-radius:4px; border:none; cursor:pointer; margin-top:0.5rem; }
    .btn.upload { background:#2ecc71; color:#fff; }
    .btn.close { background:#e74c3c; color:#fff; }
  </style>
</head>
<body>
  <h1>Jimi421 Art Gallery</h1>
  <div id="gallery"></div>

  <!-- Floating Upload Button -->
  <button id="openUpload">+</button>

  <!-- Upload Modal -->
  <div id="uploadModal">
    <div class="modal-content">
      <h2>Upload Files</h2>
      <div id="dropzone" class="dropzone">Drag &amp; drop files here or click to select</div>
      <input type="file" id="fileInput" multiple accept="image/*,video/*" />
      <button id="uploadBtn" class="btn upload">Upload</button>
      <button id="closeModal" class="btn close">Cancel</button>
    </div>
  </div>

  <script>
    const API_BASE = 'https://jimi421-art.jimi421.workers.dev';
    let filesToUpload = [];

    async function loadGallery() {
      const res = await fetch(`${API_BASE}/api/gallery`);
      const items = await res.json();
      const container = document.getElementById('gallery');
      container.innerHTML = '';
      items.reverse().forEach(item => {
        const card = document.createElement('div'); card.className = 'card';
        if (item.key.match(/\.(mp4|mov|webm)$/i)) {
          const video = document.createElement('video'); video.src = `${API_BASE}${item.url}`; video.controls = true; video.className = 'media'; card.appendChild(video);
        } else {
          const img = document.createElement('img'); img.src = `${API_BASE}${item.url}`; img.alt = item.key; img.className = 'media'; card.appendChild(img);
        }
        container.appendChild(card);
      });
    }

    // Modal controls
    const openBtn = document.getElementById('openUpload');
    const modal = document.getElementById('uploadModal');
    const closeBtn = document.getElementById('closeModal');
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');

    openBtn.onclick = () => modal.classList.add('active');
    closeBtn.onclick = () => { modal.classList.remove('active'); filesToUpload = []; dropzone.textContent = 'Drag & drop files here or click to select'; };

    dropzone.onclick = () => fileInput.click();
    dropzone.ondragover = (e) => { e.preventDefault(); dropzone.classList.add('hover'); };
    dropzone.ondragleave = () => dropzone.classList.remove('hover');
    dropzone.ondrop = (e) => {
      e.preventDefault(); dropzone.classList.remove('hover');
      filesToUpload = Array.from(e.dataTransfer.files);
      dropzone.textContent = filesToUpload.map(f => f.name).join(', ');
    };

    fileInput.onchange = () => {
      filesToUpload = Array.from(fileInput.files);
      dropzone.textContent = filesToUpload.map(f => f.name).join(', ');
    };

    uploadBtn.onclick = async () => {
      if (filesToUpload.length === 0) return;
      uploadBtn.disabled = true; uploadBtn.textContent = 'Uploading...';
      for (const file of filesToUpload) {
        const url = `${API_BASE}/api/upload?filename=${encodeURIComponent(file.name)}`;
        await fetch(url, { method: 'PUT', headers: { 'Content-Type': file.type }, body: file });
      }
      uploadBtn.disabled = false; uploadBtn.textContent = 'Upload';
      closeBtn.click();
      await loadGallery();
    };

    window.addEventListener('DOMContentLoaded', loadGallery);
  </script>
</body>
</html>
